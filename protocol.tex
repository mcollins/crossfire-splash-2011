\section {Protocol Design}
\subsection {Overview}
The CrossFire protocol is an asynchronous, bi-directional protocol designed to
enable the full functionality of the Firebug debugger in a multi-process or
remote scenario. Where it was possible, the design of the protocol took cues
from existing debug protocols () , as well as common Web
technologies (e.g. HTTP\cite{http}, JSON\cite{json}). However certain features unique to Firebug
and to debugging code running inside a Web Browser must be taken into account
in the design of the protocol.

Implementations of the protocol differ based on whether the implementation is
intended to operate as a client or server. A CrossFire server resides in or is
connected to the process which is acting as the runtime platform for the Web
page, application, or other code which is to be debugged. This is typically a
Web Browser, although supporting other runtime environments is envisioned. A
CrossFire client connects to a server in order to receive events and issue
requests, typically in order to provide a user-interface
for debugging, (e.g. GUI or command-line debugger). It is not necessary for the
client and server to reside in the same process or even the same host machine.

\subsection {Connection and Handshake}
CrossFire does not specify a standard or well-known port. Port agreement is left
up to the user, or the client software must start the server listening on
the same port it will attempt to connect to.

The CrossFire server listens for a TCP connection on the specified port
(greater than 1024).  A client wishing to connect sends the string
``CrossfireHandshake'' followed by a CRLF. The server replies with the same
string, at which point the connection is established and the client may begin
sending requests and receiving events from the server.

\subsection {Message Packets}
A well-formed CrossFire packet contains one or more headers consisting of the
header name, followed by a colon (``:``), the header value, and terminated by a
CRLF. A ``Content-Length'' header containing the number of characters in the
message body is required.

The message body is separated from the headers by a blank line
represented by a carriage-return character followed by a line-feed
character (CRLF).
The blank line should be followed by a well-formed JSON string, and terminated
by another CRLF. The message must contain a ``type'' field with the value one of
``request'', ``response'', or ``event'', and a ``seq'' field which contains the
sequence number of the packet.

Example:
TODO example packet

\subsection {Client/Server Behavior}
Once a connection has been established and a successful handshake is completed,
the server may begin sending events to the connected client using the same TCP
connection used for the handshake. A client may also begin sending requests to
the server using the same connection.

\subsection {Extensibility}
One of the goals of Crossfire is to support remote and multi-process versions of
Firebug. One of Firebug's features is its ability to be extended, and there are
already many existing extensions. Therefore, we have developed what an API for
Crossfire, called the ``Crossfire Tools API''. The Tools API allows Firebug
extension developers a clean and consistent way to access the Crossfire client
and/or server connection.

On the server-side, the Tools API allows an extension to send custom events
and handle custom requests using Crossfire's connection and transport mechanism.
A client extension can listen for these events and respond to the requests.
Using this API, it will be possible for Firebug extensions to continue to adapt
to architectural changes in future versions of Firebug.

One consequence of this design choice is that the set of possible commands or
event names cannot be specified definitively by the protocol. A Crossfire
client or server must therefore be able to accept and respond to any well-formed
message packet, even if it may not how to handle a particular command or event
type.

\subsection {Contexts}
A context in Firebug represents a single Web page.

\subsection {Breakpoints}
Breakpoint debugging is a standard tool for debugging software at runtime in
many languages and environments. The Web Browser environment creates several
challenges for designing a remote protocol which supports breakpoint debugging.
Firebug also introduces several types of breakpoints which are not present in
other environments \cite{jjb-www2010}
